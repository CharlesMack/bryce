
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Bryce Holograms — P.O.P.S. Panel</title>
<meta name="description" content="Offline-first hologram panel with CSS 3D cube, scanlines, glow, HUD, voice auto-duck, and state persistence (pops_bryce.*)." />
<style>
  /* ============== THEME TOKENS (Bryce inherits from P.O.P.S.) ============== */
  :root {
    --ink: #e7ebff;
    --muted: #a7b0d6;
    --accent: #6cf5ff;   /* cyan glow */
    --accent2: #c28bff;  /* violet glow */
    --bg: #0a0b12;
    --panel: #0f1220;
    --edge: #1a2140;
    --good: #6cff9a;
    --warn: #ffd36c;
    --danger: #ff6c9a;
    --scanline: rgba(255,255,255,0.06);
  }
  * { box-sizing: border-box; }
  html, body { height: 100%; }
  body {
    margin: 0; background: radial-gradient(1200px 600px at 60% -20%, #1c2344 0%, #0a0b12 60%);
    color: var(--ink); font: 14px/1.45 system-ui, Segoe UI, Inter, Roboto, sans-serif;
  }
  .panel {
    position: relative; max-width: 960px; margin: 24px auto; border: 1px solid var(--edge);
    border-radius: 16px; background: linear-gradient(180deg, rgba(18,22,42,.75), rgba(12,14,26,.85));
    box-shadow: 0 20px 80px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.05);
    overflow: clip;
  }
  /* HUD Top Bar */
  .hud {
    display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; gap: 12px;
    padding: 10px 12px; border-bottom: 1px solid var(--edge); background: rgba(10,12,24,.5);
    backdrop-filter: blur(6px);
  }
  .hud .title { font-weight: 600; letter-spacing:.3px; }
  .hud .clock { justify-self: center; font-variant-numeric: tabular-nums; color: var(--muted); }
  .hud .chip {
    justify-self: end; padding: 6px 10px; border: 1px solid #274;
    border-radius: 999px; background: linear-gradient(180deg, rgba(20,40,34,.6), rgba(14,22,20,.6));
    color: var(--good); font-size: 12px;
  }
  /* Stage */
  .stage-wrap { position: relative; aspect-ratio: 16/9; background: radial-gradient(60% 100% at 50% 120%, rgba(108,245,255,.15), transparent 60%),
                                   radial-gradient(60% 100% at 50% 120%, rgba(194,139,255,.12), transparent 70%),
                                   #0b0e18; }
  .stage { position:absolute; inset:0; display:grid; place-items:center; perspective: 900px; }
  /* Hologram pedestal / beam */
  .beam {
    position:absolute; left:50%; bottom:6%; transform: translateX(-50%);
    width: 52%; height: 30%; pointer-events:none;
    background: radial-gradient(ellipse at center, rgba(108,245,255,.35), rgba(108,245,255,0) 60%),
                radial-gradient(ellipse at center, rgba(194,139,255,.25), rgba(194,139,255,0) 70%);
    filter: blur(8px) saturate(120%);
  }
  .projector {
    position:absolute; left:50%; bottom:2%; transform: translateX(-50%);
    width: 320px; max-width: 56%; height: 42px; border: 1px solid var(--edge);
    border-radius: 14px; background: linear-gradient(180deg, #0e1222, #0a0c18);
    box-shadow: 0 10px 30px rgba(0,0,0,.5), 0 0 24px rgba(108,245,255,.12), 0 0 36px rgba(194,139,255,.10) inset;
  }
  .projector::after { content:""; position:absolute; inset:4px; border-radius: 12px; border: 1px dashed rgba(108,245,255,.25); }

  /* Scanline overlay */
  .scanlines { position:absolute; inset:0; pointer-events:none; opacity:.55; mix-blend-mode: screen;
    background-image: repeating-linear-gradient(
      to bottom,
      transparent 0 2px,
      var(--scanline) 2px 3px
    );
  }
  .scanlines.off { display:none; }

  /* CSS 3D HOLOGRAM CUBE */
  .holo {
    position: relative; width: 260px; height: 260px; transform-style: preserve-3d;
    filter: drop-shadow(0 0 16px rgba(108,245,255,.35)) drop-shadow(0 0 28px rgba(194,139,255,.25));
  }
  .holo.glow {
    filter: drop-shadow(0 0 24px rgba(108,245,255,.6)) drop-shadow(0 0 42px rgba(194,139,255,.45));
  }
  .holo .face {
    position: absolute; inset:0; background: linear-gradient(180deg, rgba(108,245,255,.25), rgba(194,139,255,.08));
    border: 1px solid rgba(108,245,255,.55); box-shadow: inset 0 0 28px rgba(194,139,255,.25);
    backdrop-filter: blur(1.5px) saturate(120%);
  }
  .holo .f1 { transform: translateZ(130px); }
  .holo .f2 { transform: rotateY(90deg) translateZ(130px); }
  .holo .f3 { transform: rotateY(180deg) translateZ(130px); }
  .holo .f4 { transform: rotateY(-90deg) translateZ(130px); }
  .holo .f5 { transform: rotateX(90deg) translateZ(130px); }
  .holo .f6 { transform: rotateX(-90deg) translateZ(130px); }

  /* Controls */
  .controls {
    display:flex; flex-wrap:wrap; gap:10px; padding:12px; border-top:1px solid var(--edge);
    background: linear-gradient(180deg, rgba(11,14,24,.6), rgba(9,10,16,.8));
  }
  .controls .group { display:flex; align-items:center; gap:8px; padding:8px 10px; border:1px solid var(--edge); border-radius:12px; background:#0e1222; }
  label { color: var(--muted); font-size:12px; }
  input[type="range"] { width:160px; }
  button, .toggle {
    appearance:none; border:1px solid var(--edge); background: linear-gradient(180deg, #142036, #0e1222);
    color:var(--ink); padding:8px 10px; border-radius:10px; cursor:pointer;
  }
  .toggle.active, button.primary { border-color: rgba(108,245,255,.6); box-shadow: 0 0 0 1px rgba(108,245,255,.2) inset, 0 0 20px rgba(108,245,255,.15); }
  select { background:#0e1222; color:var(--ink); border:1px solid var(--edge); border-radius:10px; padding:6px 8px; }

  .kbd { padding:2px 6px; border:1px solid var(--edge); border-radius:6px; background:#0b0e18; font-size:11px; color:var(--muted); }
  .hint { margin-left:auto; color:var(--muted); font-size:12px; }

  /* Accessibility helpers */
  .sr-only { position:absolute; width:1px; height:1px; margin:-1px; padding:0; border:0; clip:rect(0 0 0 0); overflow:hidden; }
</style>
</head>
<body>
  <main class="panel" aria-label="Bryce Holograms panel">
    <header class="hud">
      <div class="title">Bryce Holograms <span style="color:var(--muted)">• P.O.P.S. Grandson</span></div>
      <div class="clock" id="clock">--:--:--</div>
      <div class="chip" id="chip">personality: <strong>guide</strong></div>
    </header>

    <section class="stage-wrap">
      <div class="stage" aria-live="polite">
        <div id="scanlines" class="scanlines"></div>
        <div id="cube" class="holo glow" aria-label="Holographic cube" tabindex="0">
          <div class="face f1"></div>
          <div class="face f2"></div>
          <div class="face f3"></div>
          <div class="face f4"></div>
          <div class="face f5"></div>
          <div class="face f6"></div>
        </div>
        <div class="beam"></div>
        <div class="projector" aria-hidden="true"></div>
      </div>
    </section>

    <section class="controls" aria-label="Controls">
      <div class="group">
        <button id="btnPlay" class="toggle active" aria-pressed="true">Rotate <span class="kbd">Space</span></button>
        <label for="speed">Speed</label>
        <input id="speed" type="range" min="0" max="0.06" step="0.001" value="0.015" />
        <span class="hint">± <span class="kbd">+</span>/<span class="kbd">-</span></span>
      </div>
      <div class="group">
        <button id="btnGlow" class="toggle active">Glow <span class="kbd">G</span></button>
        <button id="btnScan" class="toggle active">Scanlines <span class="kbd">S</span></button>
        <label for="layer">Layer</label>
        <select id="layer">
          <option value="none">None</option>
          <option value="cinema">Cinema</option>
          <option value="noir">Noir</option>
          <option value="pop">Pop</option>
        </select>
      </div>
      <div class="group">
        <button id="btnSpeak" class="toggle">Voice</button>
        <button id="btnQuip">Say hi</button>
        <button id="btnHum" class="toggle">Projector hum</button>
      </div>
      <div class="group">
        <button id="btnReset">Reset</button>
      </div>
      <div class="hint">Drag: rotate with mouse • Wheel: zoom</div>
    </section>
  </main>

<script>
// ================== State (pops_bryce.*) ==================
const NS = 'pops_bryce.holograms';
const state = {
  rotationSpeed: 0.015,
  rotating: true,
  glow: true,
  scanlines: true,
  layer: 'none',
  speak: false,
  hum: false,
  personality: 'guide',
  zoom: 1,
  rx: -18, ry: 24
};

function save() { localStorage.setItem(NS, JSON.stringify(state)); }
function load() {
  try { Object.assign(state, JSON.parse(localStorage.getItem(NS) || '{}')); }
  catch(e){}
}
load();

// ================== Elements ==================
const cube = document.getElementById('cube');
const scan = document.getElementById('scanlines');
const clockEl = document.getElementById('clock');
const chip = document.getElementById('chip');

const btnPlay = document.getElementById('btnPlay');
const speed = document.getElementById('speed');
const btnGlow = document.getElementById('btnGlow');
const btnScan = document.getElementById('btnScan');
const layerSel = document.getElementById('layer');
const btnSpeak = document.getElementById('btnSpeak');
const btnQuip = document.getElementById('btnQuip');
const btnHum = document.getElementById('btnHum');
const btnReset = document.getElementById('btnReset');

// ================== HUD ==================
function tickClock(){
  const d = new Date();
  const pad = n => String(n).padStart(2,'0');
  clockEl.textContent = `${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
}
setInterval(tickClock, 1000); tickClock();

function updateChip(){ chip.innerHTML = `personality: <strong>${state.personality}</strong>`; }
updateChip();

// ================== Layer Filters ==================
function applyLayer(){
  const wrap = document.querySelector('.stage-wrap');
  wrap.style.filter = 'none';
  switch(state.layer){
    case 'cinema':
      wrap.style.filter = 'contrast(1.08) saturate(1.1) brightness(1.02)';
      break;
    case 'noir':
      wrap.style.filter = 'grayscale(1) contrast(1.2) brightness(1.05)';
      break;
    case 'pop':
      wrap.style.filter = 'saturate(1.35) contrast(1.05)';
      break;
  }
}

// ================== Rotation & Interaction ==================
let raf; let last = performance.now();
function loop(t){
  raf = requestAnimationFrame(loop);
  const dt = (t - last) / 1000; last = t;
  if(state.rotating){ state.ry += state.rotationSpeed * 360 * dt; }
  cube.style.transform = `translateZ(0px) rotateX(${state.rx}deg) rotateY(${state.ry}deg) scale(${state.zoom})`;
}

function playToggle(on){
  state.rotating = (on!==undefined)? on : !state.rotating; save();
  btnPlay.classList.toggle('active', state.rotating);
  btnPlay.setAttribute('aria-pressed', String(state.rotating));
}

// Drag rotate & wheel zoom
let dragging = false, px=0, py=0;
 cube.addEventListener('pointerdown', e=>{ dragging=true; px=e.clientX; py=e.clientY; cube.setPointerCapture(e.pointerId); });
 cube.addEventListener('pointermove', e=>{
   if(!dragging) return;
   state.ry += (e.clientX - px) * 0.25; state.rx -= (e.clientY - py) * 0.25; px=e.clientX; py=e.clientY; save();
 });
 cube.addEventListener('pointerup', ()=>{ dragging=false; });
 cube.addEventListener('wheel', e=>{ e.preventDefault(); state.zoom = Math.min(1.8, Math.max(0.6, state.zoom + (e.deltaY>0?-0.06:0.06))); save(); }, {passive:false});

// ================== Voice + Auto-duck ==================
let voiceOn = !!state.speak;
let humOn = !!state.hum;
let ac, humGain;

function ensureAudio(){
  if(ac) return; // create on-demand after gesture
  ac = new (window.AudioContext||window.webkitAudioContext)();
  humGain = ac.createGain(); humGain.gain.value = 0.0; humGain.connect(ac.destination);
  const osc = ac.createOscillator(); osc.type = 'sawtooth';
  const low = ac.createBiquadFilter(); low.type='lowpass'; low.frequency.value = 220;
  const lfo = ac.createOscillator(); lfo.frequency.value = 17; // tremble
  const lfoGain = ac.createGain(); lfoGain.gain.value = 6;
  lfo.connect(lfoGain).connect(low.detune);
  osc.connect(low).connect(humGain); osc.start(); lfo.start();
}

function setHum(active){
  ensureAudio();
  humOn = active; state.hum = active; save();
  const target = active ? 0.08 : 0.0;
  if(ac){ const now = ac.currentTime; humGain.gain.cancelScheduledValues(now); humGain.gain.linearRampToValueAtTime(target, now + 0.25); }
  btnHum.classList.toggle('active', active);
}

function setVoice(active){
  voiceOn = active; state.speak = active; save();
  btnSpeak.classList.toggle('active', active);
}

function quip(){
  if(!voiceOn) return;
  const s = new SpeechSynthesisUtterance();
  s.text = pick([
    'Booting hologram. Smooth and luminous.',
    'Guide mode engaged. How can I help?',
    'Lightfield calibrated. Let us begin.',
    'P.O.P.S. lineage acknowledged. Grandson online.'
  ]);
  s.rate = 1.0; s.pitch = 1.05;
  // Auto-duck projector hum
  s.onstart = ()=> { if(humOn && humGain){ humGain.gain.linearRampToValueAtTime(0.015, ac.currentTime + 0.05); } };
  s.onend   = ()=> { if(humOn && humGain){ humGain.gain.linearRampToValueAtTime(0.08, ac.currentTime + 0.05); } };
  window.speechSynthesis.speak(s);
}

function pick(a){ return a[Math.floor(Math.random()*a.length)]; }

// ================== UI Wire-up ==================
function boot(){
  // apply saved
  speed.value = state.rotationSpeed;
  playToggle(state.rotating);
  cube.classList.toggle('glow', state.glow);
  btnGlow.classList.toggle('active', state.glow);
  scan.classList.toggle('off', !state.scanlines);
  btnScan.classList.toggle('active', state.scanlines);
  layerSel.value = state.layer; applyLayer();
  // start loop
  last = performance.now(); cancelAnimationFrame(raf); raf = requestAnimationFrame(loop);
}

btnPlay.addEventListener('click', ()=>{ playToggle(); });
btnGlow.addEventListener('click', ()=>{ state.glow=!state.glow; cube.classList.toggle('glow', state.glow); btnGlow.classList.toggle('active', state.glow); save(); });
btnScan.addEventListener('click', ()=>{ state.scanlines=!state.scanlines; scan.classList.toggle('off', !state.scanlines); btnScan.classList.toggle('active', state.scanlines); save(); });
layerSel.addEventListener('change', ()=>{ state.layer = layerSel.value; applyLayer(); save(); });

speed.addEventListener('input', ()=>{ state.rotationSpeed = parseFloat(speed.value); save(); });

btnSpeak.addEventListener('click', ()=>{ setVoice(!voiceOn); });
btnQuip.addEventListener('click', ()=>{ ensureAudio(); quip(); });
btnHum.addEventListener('click', ()=>{ setHum(!humOn); });

btnReset.addEventListener('click', ()=>{
  Object.assign(state, { rotationSpeed:0.015, rotating:true, glow:true, scanlines:true, layer:'none', speak:false, hum:false, zoom:1, rx:-18, ry:24 });
  save(); boot(); btnSpeak.classList.remove('active'); btnHum.classList.remove('active');
});

// Keyboard shortcuts
window.addEventListener('keydown', e=>{
  if(e.key===' ') { e.preventDefault(); playToggle(); }
  else if(e.key.toLowerCase()==='g') { btnGlow.click(); }
  else if(e.key.toLowerCase()==='s') { btnScan.click(); }
  else if(e.key==='+') { state.rotationSpeed = Math.min(0.06, state.rotationSpeed+0.003); speed.value=state.rotationSpeed; save(); }
  else if(e.key==='-') { state.rotationSpeed = Math.max(0.0, state.rotationSpeed-0.003); speed.value=state.rotationSpeed; save(); }
});

// Boot
boot();
</script>
</body>
</html>
